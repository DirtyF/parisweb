{"version":3,"sources":["app.js"],"names":["Search","init","search","instantsearch","appId","apiKey","indexName","urlSync","searchFunction","helper","lazyloadCounter","showMoreTemplates","inactive","active","on","onRender","addSearchBoxWidget","addTypeWidget","addYearWidget","addTagsWidget","addAuthorsWidget","addHitsWidget","start","cloudinary","url","options","baseUrl","stringOptions","width","push","height","quality","crop","radius","format","colorize","grayscale","color","gravity","replace","join","transformItem","data","inViewport","undefined","isConference","type","isWorkshop","description","_snippetResult","value","authors","_","map","author","index","picture","name","_highlightResult","displayData","uuid","objectID","title","getHighlightedValue","year","tags","object","property","has","hits","$","onVisible","hit","addClass","each","offset","addWidget","widgets","searchBox","container","placeholder","addStatsWidget","stats","refinementList","attributeName","rangeSlider","tooltips","parseInt","pips","step","operator","sortBy","limit","showMore","templates","hitTemplate","html","hitsPerPage","item","transformData","addPaginationWidget","pagination","labels","previous","next","showFirstLast","addCurrentRefinedValues","currentRefinedValues","clearAll"],"mappings":"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","file":"public/app.js","sourcesContent":["let Search = {\n  init() {\n    this.search = instantsearch({\n      appId: 'O3F8QXYK6R',\n      apiKey: 'cb3f3d3a43a5996e9f5ba74003462a4f',\n      indexName: 'parisweb',\n      urlSync: true,\n      searchFunction: (helper) => {\n        // Reset the lazyloadCounter\n        Search.lazyloadCounter = 0;\n        helper.search();\n      }\n    });\n\n    this.showMoreTemplates = {\n      inactive:'<a class=\"ais-show-more ais-show-more__inactive\">Voir plus</a>',\n      active:'<a class=\"ais-show-more ais-show-more__active\">Voir moins</a>'\n    }\n\n    this.search.on('render', this.onRender);\n\n    this.addSearchBoxWidget();\n    // this.addStatsWidget();\n    this.addTypeWidget();\n    this.addYearWidget();\n    this.addTagsWidget();\n    this.addAuthorsWidget();\n    this.addHitsWidget();\n    // this.addPaginationWidget();\n    // this.addCurrentRefinedValues();\n\n    this.search.start();\n  },\n  cloudinary(url, options) {\n    let baseUrl = 'http://res.cloudinary.com/pixelastic-parisweb/image/fetch/';\n    let stringOptions = [];\n\n    // http://res.cloudinary.com/pixelastic-parisweb/image/fetch/h_50,q_90,c_scale,r_max,f_auto/https://www.paris-web.fr/2015/assets_c/2015/05/Martin%20Naumann-thumb-143x143-487.jpg\n    // Handle common Cloudinary options\n    if (options.width) {\n      stringOptions.push(`w_${options.width}`);\n    }\n    if (options.height) {\n      stringOptions.push(`h_${options.height}`);\n    }\n    if (options.quality) {\n      stringOptions.push(`q_${options.quality}`);\n    }\n    if (options.crop) {\n      stringOptions.push(`c_${options.crop}`);\n    }\n    if (options.radius) {\n      stringOptions.push(`r_${options.radius}`);\n    }\n    if (options.format) {\n      stringOptions.push(`f_${options.format}`);\n    }\n    if (options.colorize) {\n      stringOptions.push(`e_colorize:${options.colorize}`);\n    }\n    if (options.grayscale) {\n      stringOptions.push(`e_grayscale`);\n    }\n    if (options.color) {\n      stringOptions.push(`co_rgb:${options.color}`);\n    }\n    if (options.gravity) {\n      stringOptions.push(`g_${options.gravity}`);\n    }\n\n    // Fix remote urls\n    url = url.replace(/^\\/\\//, 'http://');\n\n    return `${baseUrl}${stringOptions.join(',')}/${url}`;\n  },\n  transformItem(data) {\n    // All items are defered loading their images until in viewport, except\n    // the 4 first\n    let inViewport = false;\n    if (Search.lazyloadCounter === undefined || Search.lazyloadCounter < 4) {\n      inViewport = true;\n    }\n    Search.lazyloadCounter++;\n\n    let isConference = data.type == 'Conférence';\n    let isWorkshop = data.type == 'Atelier';\n\n    let description = data._snippetResult.description.value;\n    description = description.replace(' …', '…');\n\n    // Get only authors name and pictures\n    // TODO: It should be possible to further select/unselect on clicking on\n    // authors\n    let authors = _.map(data.authors, (author, index) => {\n      let picture = Search.cloudinary(author.picture, {\n        height: 50,\n        width: 50,\n        quality: 90,\n        grayscale: true,\n        crop: 'scale',\n        radius: 'max',\n        format: 'auto'\n      });\n      return {\n        name: data._highlightResult.authors[index].name.value,\n        picture\n      }\n    });\n\n    // TODO: Thumbnails\n    // If there is a dailymotion/youtube video, we can try to get the thumbnail\n    // Check if possible to get one from slideshare and other hosting\n    // webservices\n    // Otherwise, downloading the PDF, extracting the first page and pushing it\n    // along the content\n\n    // TODO: Tags\n    // - We should be able to click on tags to further select/unselect them\n    // - If a selection is currently made on a tag, it should be visible\n\n    let displayData = {\n      uuid: data.objectID,\n      inViewport,\n      isConference,\n      isWorkshop,\n      title: Search.getHighlightedValue(data, 'title'),\n      description,\n      year: data.year,\n      tags: data.tags,\n      authors\n    };\n\n    return displayData;\n  },\n  getHighlightedValue(object, property) {\n    if (!_.has(object, `_highlightResult.${property}.value`)) {\n      return object[property];\n    }\n    return object._highlightResult[property].value;\n  },\n  // Enable lazyloading of images below the fold\n  onRender() {\n    let hits = $('.hit');\n    function onVisible(hit) {\n      $(hit).addClass('hit__inViewport');\n    }\n    _.each(hits, (hit) => {\n      inViewport(hit, {offset: 50}, onVisible);\n    });\n  },\n  addSearchBoxWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.searchBox({\n        container: '#q',\n        placeholder: 'Rechercher une conférence, un orateur, un thème...'\n      })\n    );\n  },\n  addStatsWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.stats({\n        container: '#stats'\n      })\n    );\n  },\n  addTypeWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#type',\n        attributeName: 'type'\n      })\n    );\n  },\n  addYearWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.rangeSlider({\n        container: '#year',\n        attributeName: 'year',\n        tooltips: {\n          format: _.parseInt\n        },\n        pips: false,\n        step: 1\n      })\n    );\n  },\n  addAuthorsWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#authors',\n        attributeName: 'authors.name',\n        operator: 'or',\n        sortBy: ['isRefined', 'count:desc', 'name:asc'],\n        limit: 10,\n        showMore: {\n          limit: 20,\n          templates: Search.showMoreTemplates\n        }\n      })\n    );\n  },\n  addTagsWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#tags',\n        attributeName: 'tags',\n        operator: 'and',\n        limit: 10,\n        showMore: {\n          limit: 20,\n          templates: Search.showMoreTemplates\n        }\n      })\n    );\n  },\n  addHitsWidget() {\n    let hitTemplate = $('#hitTemplate').html();\n    this.search.addWidget(\n      instantsearch.widgets.hits({\n        container: '#hits',\n        hitsPerPage: 10,\n        templates: {\n          item: hitTemplate\n        },\n        transformData: {\n          item: Search.transformItem\n        }\n      })\n    );\n  },\n  addPaginationWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.pagination({\n        container: '#pagination',\n        labels: {\n          previous: '‹ Previous',\n          next: 'Next ›'\n        },\n        showFirstLast: false\n      })\n    );\n  },\n  addCurrentRefinedValues() {\n    this.search.addWidget(\n      instantsearch.widgets.currentRefinedValues({\n        container: '#current-refined-values',\n        clearAll: 'before'\n      })\n    );\n  }\n};\n\nexport default Search;\n"]}